import{U as L,T as Y,r as d,o as Z,X as I,Y as x,Z as J,h as e,a0 as a,aY as O,a2 as X,ab as G,aZ as H,a4 as o,V as p,a7 as K,a8 as Q,ai as S,J as _,a5 as h,a6 as U,aC as W,$ as P,al as ee,ak as ae,am as w,a_ as T}from"./index-299bec5c.js";import{u as le,a as k}from"./vee-validate.esm-0fc75ee8.js";import{v as te}from"./index-ee6bba0e.js";import{c as oe,a as C}from"./index.esm-639fe0e0.js";import{V as se}from"./VContainer-d6c8194b.js";import{V as R,a as g}from"./VRow-ce1dde76.js";import{V as ne,a as re}from"./VToolbar-a49876ff.js";import{V as ue}from"./VForm-d75d2a0a.js";const ie={class:"third"},he={__name:"ProfileView",setup(de){const{apiAuth:y}=G(),s=L(),c=Y(),u=d(!1),B=d(null),V=d(!1),z=r=>{V.value=!0},F=()=>{V.value=!1,B.value.deleteFileRecord()},b=d(!1),D=oe({account:C().required("缺少使用者帳號").test("isEmail","信箱格式錯誤",r=>te.isEmail(r)),name:C().required("缺少使用者名稱"),phone:C()}),{handleSubmit:j,isSubmitting:A}=le({validationSchema:D,initialValues:{account:"",name:"",phone:""}}),m=k("account"),v=k("name"),f=k("phone");m.value.value=s.account,v.value.value=s.name,f.value.value=s.phone;const E=()=>{m.value.value=s.account,v.value.value=s.name,f.value.value=s.phone,u.value=!1},$=j(async r=>{var l,n;try{await y.patch("/users/self",r),s.getProfile(),c({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"forth",location:"center"}}),u.value=!1}catch(t){console.log(t);const q=((n=(l=t==null?void 0:t.response)==null?void 0:l.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";c({text:q,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"seventh",location:"center"}})}}),i=d([]),M=d([]),N=async()=>{var r,l;if(b.value=!0,!i.value[0].error){try{const n=new FormData;i.value.length>0&&n.append("image",i.value[0].file),s.avatar=URL.createObjectURL(i.value[0].file),await y.patch("/users/avatar",n),s.getProfile(),c({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"forth",location:"bottom"}}),F()}catch(n){console.log(n);const t=((l=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";c({text:t,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"seventh",location:"bottom"}})}b.value=!1}};return Z(async()=>{try{s.getProfile()}catch{c({text:"沒取到pinia，發生錯誤，請稍後再試",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"seventh",location:"bottom"}})}}),(r,l)=>{const n=I("VueFileAgent");return x(),J(X,null,[e(se,null,{default:a(()=>[e(R,{class:"justify-center pt-10"},{default:a(()=>[e(g,{cols:"12",class:"text-center",md:"6",lg:"6"},{default:a(()=>[e(H,{image:o(s).avatar,size:"260"},null,8,["image"]),e(p,{icon:"mdi-pencil",size:"x-small",color:"third",style:{"vertical-align":"bottom"},variant:"tonal",onClick:z}),K("h2",ie,Q(o(s).account),1)]),_:1}),e(g,{cols:"12",md:"6",lg:"6"},{default:a(()=>[e(S,{class:"bg-eigth"},{default:a(()=>[e(ne,{color:"third",flat:""},{default:a(()=>[e(_,{class:"ps-8",icon:"mdi-account"}),e(re,{class:"font-weight-bold"},{default:a(()=>[h("個人資料")]),_:1}),e(U),e(p,{icon:""},{default:a(()=>[e(W,{"leave-absolute":""},{default:a(()=>[u.value?(x(),P(_,{key:0,onClick:E,icon:"mdi-close",variant:"tonal"})):(x(),P(_,{key:1,icon:"mdi-pencil",onClick:l[0]||(l[0]=t=>u.value=!0),variant:"tonal"}))]),_:1})]),_:1})]),_:1}),e(ue,{onSubmit:ee(o($),["prevent"]),disabled:!u.value||o(A)},{default:a(()=>[e(ae,{class:"pa-10"},{default:a(()=>[e(R,null,{default:a(()=>[e(g,{cols:"12",class:"pb-0"},{default:a(()=>[e(w,{label:"帳號",variant:"outlined",density:"comfortable",modelValue:o(m).value.value,"onUpdate:modelValue":l[1]||(l[1]=t=>o(m).value.value=t),"error-messages":o(m).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(g,{cols:"12",class:"pb-0"},{default:a(()=>[e(w,{label:"姓名",variant:"outlined",density:"comfortable",modelValue:o(v).value.value,"onUpdate:modelValue":l[2]||(l[2]=t=>o(v).value.value=t),"error-messages":o(v).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(g,{cols:"12",class:"pb-0"},{default:a(()=>[e(w,{label:"電話",variant:"outlined",density:"comfortable",modelValue:o(f).value.value,"onUpdate:modelValue":l[3]||(l[3]=t=>o(f).value.value=t),"error-messages":o(f).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),e(T,null,{default:a(()=>[e(p,{color:"third",size:"x-large",class:"font-weight-bold d-flex w-100",variant:"tonal",type:"submit",loading:o(A),disabled:!u.value},{default:a(()=>[h(" 確認修改個人資料 ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),e(O,{modelValue:V.value,"onUpdate:modelValue":l[6]||(l[6]=t=>V.value=t),width:"300px"},{default:a(()=>[e(S,{rounded:"xl",class:"px-5 pt-5"},{default:a(()=>[e(n,{modelValue:i.value,"onUpdate:modelValue":l[4]||(l[4]=t=>i.value=t),rawModelValue:M.value,"onUpdate:rawModelValue":l[5]||(l[5]=t=>M.value=t),accept:"image/jpeg, image/png","max-size":"1MB","error-text":{type:"檔案格式不支援, 只接受 .jepg .png",size:"檔案大小超過 1MB"},deletable:"","help-text":"選擇大頭貼圖片或拖曳到這裡","max-files":1,ref_key:"fileAgent",ref:B},null,8,["modelValue","rawModelValue","error-text"]),e(T,null,{default:a(()=>[e(U),e(p,{color:"seventh",rounded:"",onClick:F,disabled:b.value},{default:a(()=>[h("取消")]),_:1},8,["disabled"]),e(p,{color:"forth",rounded:"",onClick:N,disabled:b.value},{default:a(()=>[h("送出")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};export{he as default};
