import{$ as F,Z as w,Y as R,x as k,A as C,a1 as L,a2 as p,a4 as f,a5 as n,c as a,ac as _,V as T,ak as $,aa as v,ad as x,a9 as m,am as A,an as M,J as N,aj as j,ag as P,ao as D,a3 as U,a8 as z,a7 as E,ap as I,aq as J}from"./index-480ebe02.js";import{u as W,a as Y}from"./vee-validate.esm-50192be0.js";import{V as Z}from"./VForm-f76b1fb9.js";import{g as G}from"./index-7d9a9c74.js";import{V as H}from"./VContainer-c419f79e.js";import{a as V,V as K}from"./VRow-082ae1c5.js";import{V as O}from"./VDivider-6f168799.js";const Q={class:"overflow-hidden"},X={class:"px-4 my-2"},tt={__name:"ProductCard",props:["_id","category","description","images","name","price","sell"],setup(l){const{api:g,apiAuth:h}=P(),c=F(),s=w(),u=R(),e=l,o=k({_id:"",name:"",price:0,description:"",images:[],sell:!0,category:""}),{isSubmitting:y,handleSubmit:B}=W({initialValues:{quantity:1}}),b=Y("quantity"),S=B(async d=>{var i,t;if(!c.isLogin){s({text:"請先登入再加入購物車",showCloseButton:!1,snackbarProps:{timeout:1e3,color:"red",location:"top"}}),u.push("/signup");return}if(c.blacklist){s({text:"您已被停權，無法加入購物車",showCloseButton:!1,snackbarProps:{timeout:1e3,color:"red",location:"top"}});return}try{const{data:r}=await h.patch("/users/cart",{product:e._id,quantity:d.quantity});c.cart=r.result,s({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(r){const q=((t=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";s({text:q,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return C(async()=>{var d,i;try{const{data:t}=await g.get("/products/");o.value._id=t.result._id,o.value.name=t.result.name,o.value.price=t.result.price,o.value.description=t.result.description,o.value.images=t.result.images,o.value.sell=t.result.sell,o.value.category=t.result.category}catch(t){const r=((i=(d=t==null?void 0:t.response)==null?void 0:d.data)==null?void 0:i.message)||"發生錯誤，請稍後再試";s({text:r,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}),u.push("/")}}),(d,i)=>{const t=L("RouterLink");return p(),f(j,{class:"product-card",width:"380"},{default:n(()=>[a(t,{to:"/products/"+l._id,class:"text-decoration-none text-ninth"},{default:n(()=>[_("div",Q,[a(T,{src:l.images[0],cover:"",width:"100%",height:"300",class:"img-enlarge"},null,8,["src"])]),a($,{class:"font-weight-bold text-h5 my-0 py-1"},{default:n(()=>[v(x(l.name),1)]),_:1})]),_:1},8,["to"]),_("p",X,"售價$"+x(l.price),1),a(Z,{disabled:m(y),onSubmit:A(m(S),["prevent"])},{default:n(()=>[a(M,{type:"number",min:"1",modelValue:m(b).value.value,"onUpdate:modelValue":i[0]||(i[0]=r=>m(b).value.value=r),modelModifiers:{number:!0},variant:"outlined",placeholder:"數量",style:{width:"95%"},class:"mx-auto mb-0"},null,8,["modelValue"]),a(N,{type:"submit","prepend-icon":"mdi-cart",loading:m(y),style:{width:"100%",height:"50px"},color:"seventh"},{default:n(()=>[v("加入購物車")]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]),_:1})}}};const et=_("h1",{class:"text-center third"},"商品資訊",-1),ct={__name:"ProductView",setup(l){const{api:g}=P(),h=w(),c=k([]);return C(async()=>{var s,u;try{const{data:e}=await g.get("/products",{params:{itemsPerPage:-1}});c.value.push(...e.result.data),await D(),G.from(".product",{opacity:0,duration:.7,stagger:.3})}catch(e){console.log(e);const o=((u=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:u.message)||"發生錯誤，請稍後再試";h({text:o,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),(s,u)=>(p(),f(H,{"max-width":"1200"},{default:n(()=>[a(K,null,{default:n(()=>[a(V,{cols:"12"},{default:n(()=>[et]),_:1}),a(O),(p(!0),U(E,null,z(c.value,e=>(p(),f(V,{cols:"12",md:"6",lg:"4",key:e._id,class:"d-flex justify-center product"},{default:n(()=>[a(tt,I(J(e)),null,16)]),_:2},1024))),128))]),_:1})]),_:1}))}};export{ct as default};
