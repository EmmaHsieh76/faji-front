import{U as I,T as L,r as d,X as Y,Y as k,Z,h as e,a0 as l,aY as J,a2 as O,ab as X,aZ as G,a4 as o,V as f,a7 as H,a8 as K,ai as U,J as x,a5 as h,a6 as M,aC as Q,$ as T,al as W,ak as ee,am as _,a_ as P}from"./index-9f60672d.js";import{u as ae,a as w}from"./vee-validate.esm-93f897a7.js";import{v as le}from"./index-ee6bba0e.js";import{c as te,a as C}from"./index.esm-639fe0e0.js";import{V as oe}from"./VContainer-cf9646b0.js";import{V as R,a as p}from"./VRow-da5ccac1.js";import{V as se,a as ne}from"./VToolbar-6f9ca9da.js";import{V as re}from"./VForm-72ca7d32.js";const ue={class:"third"},be={__name:"ProfileView",setup(ie){const{apiAuth:y}=X(),n=I(),g=L(),u=d(!1),B=d(null),V=d(!1),z=r=>{V.value=!0},F=()=>{V.value=!1,B.value.deleteFileRecord()},b=d(!1),D=te({account:C().required("缺少使用者帳號").test("isEmail","信箱格式錯誤",r=>le.isEmail(r)),name:C().required("缺少使用者名稱"),phone:C()}),{handleSubmit:j,isSubmitting:S}=ae({validationSchema:D,initialValues:{account:"",name:"",phone:""}}),c=w("account"),m=w("name"),v=w("phone");c.value.value=n.account,m.value.value=n.name,v.value.value=n.phone;const E=()=>{c.value.value=n.account,m.value.value=n.name,v.value.value=n.phone,u.value=!1},$=j(async r=>{var t,s;try{await y.patch("/users/self",r),n.getProfile(),g({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"third",location:"center"}}),u.value=!1}catch(a){console.log(a);const q=((s=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";g({text:q,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"seventh",location:"center"}})}}),i=d([]),A=d([]),N=async()=>{var r,t;if(b.value=!0,!i.value[0].error){try{const s=new FormData;i.value.length>0&&s.append("image",i.value[0].file),n.avatar=URL.createObjectURL(i.value[0].file);const a=await y.patch("/users/avatar",s);a.data.token&&(localStorage.setItem("token",a.data.token),n.token=a.data.token),g({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"forth",location:"bottom"}}),F()}catch(s){console.log(s);const a=((t=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";g({text:a,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"seventh",location:"bottom"}})}b.value=!1}};return(r,t)=>{const s=Y("VueFileAgent");return k(),Z(O,null,[e(oe,null,{default:l(()=>[e(R,{class:"justify-center pt-10"},{default:l(()=>[e(p,{cols:"12",class:"text-center",md:"6",lg:"6"},{default:l(()=>[e(G,{image:o(n).avatar,size:"260"},null,8,["image"]),e(f,{icon:"mdi-pencil",size:"x-small",color:"third",style:{"vertical-align":"bottom"},variant:"tonal",onClick:z}),H("h2",ue,K(o(n).account),1)]),_:1}),e(p,{cols:"12",md:"6",lg:"6"},{default:l(()=>[e(U,{class:"bg-eigth"},{default:l(()=>[e(se,{color:"third",flat:""},{default:l(()=>[e(x,{class:"ps-8",icon:"mdi-account"}),e(ne,{class:"font-weight-bold"},{default:l(()=>[h("個人資料")]),_:1}),e(M),e(f,{icon:""},{default:l(()=>[e(Q,{"leave-absolute":""},{default:l(()=>[u.value?(k(),T(x,{key:0,onClick:E,icon:"mdi-close",variant:"tonal"})):(k(),T(x,{key:1,icon:"mdi-pencil",onClick:t[0]||(t[0]=a=>u.value=!0),variant:"tonal"}))]),_:1})]),_:1})]),_:1}),e(re,{onSubmit:W(o($),["prevent"]),disabled:!u.value||o(S)},{default:l(()=>[e(ee,{class:"pa-10"},{default:l(()=>[e(R,null,{default:l(()=>[e(p,{cols:"12",class:"pb-0"},{default:l(()=>[e(_,{label:"帳號",variant:"outlined",density:"comfortable",modelValue:o(c).value.value,"onUpdate:modelValue":t[1]||(t[1]=a=>o(c).value.value=a),"error-messages":o(c).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(p,{cols:"12",class:"pb-0"},{default:l(()=>[e(_,{label:"姓名",variant:"outlined",density:"comfortable",modelValue:o(m).value.value,"onUpdate:modelValue":t[2]||(t[2]=a=>o(m).value.value=a),"error-messages":o(m).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(p,{cols:"12",class:"pb-0"},{default:l(()=>[e(_,{label:"電話",variant:"outlined",density:"comfortable",modelValue:o(v).value.value,"onUpdate:modelValue":t[3]||(t[3]=a=>o(v).value.value=a),"error-messages":o(v).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),e(P,null,{default:l(()=>[e(f,{color:"third",size:"x-large",class:"font-weight-bold d-flex w-100",variant:"tonal",type:"submit",loading:o(S),disabled:!u.value},{default:l(()=>[h(" 確認修改個人資料 ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),e(J,{modelValue:V.value,"onUpdate:modelValue":t[6]||(t[6]=a=>V.value=a),width:"300px"},{default:l(()=>[e(U,{rounded:"xl",class:"px-5 pt-5"},{default:l(()=>[e(s,{modelValue:i.value,"onUpdate:modelValue":t[4]||(t[4]=a=>i.value=a),rawModelValue:A.value,"onUpdate:rawModelValue":t[5]||(t[5]=a=>A.value=a),accept:"image/jpeg, image/png","max-size":"1MB","error-text":{type:"檔案格式不支援, 只接受 .jepg .png",size:"檔案大小超過 1MB"},deletable:"","help-text":"選擇大頭貼圖片或拖曳到這裡","max-files":1,ref_key:"fileAgent",ref:B},null,8,["modelValue","rawModelValue","error-text"]),e(P,null,{default:l(()=>[e(M),e(f,{color:"seventh",rounded:"",onClick:F,disabled:b.value},{default:l(()=>[h("取消")]),_:1},8,["disabled"]),e(f,{color:"forth",rounded:"",onClick:N,disabled:b.value},{default:l(()=>[h("送出")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};export{be as default};
