import{p as ae,g as le,u as te,c as e,G as L,b6 as me,aC as ve,K,b8 as pe,o as oe,D as be,b9 as fe,ba as E,a7 as ge,bc as Ve,Z as ke,x as i,a2 as N,a3 as ye,a5 as t,aX as Z,ag as he,an as xe,bb as Ce,a4 as j,a6 as z,J as x,aj as H,W as O,al as J,aa as f,ad as Pe,a9 as n,aZ as W,ab as X,am as Re,ak as Ie,ac as se}from"./index-a033bc4d.js";import{c as _e,a as Q,d as Se,e as we}from"./index.esm-639fe0e0.js";import{u as Be,a as U}from"./vee-validate.esm-15d428dc.js";import{V as Ue}from"./VContainer-7cb1f23d.js";import{V as $e,a as Y}from"./VRow-0baba5fc.js";import{V as Ae,a as De}from"./VTextarea-5939f96d.js";import{V as Fe}from"./VForm-1260d785.js";import{d as Ge,e as re,f as Te,g as Me}from"./VDataTable-4b4ec186.js";import"./VTable-9956a63a.js";import"./VList-6ff59a86.js";import"./ssrBoot-79000be3.js";import"./VDivider-de42d59d.js";import"./VChip-20eadd59.js";import"./VSlideGroup-841e3371.js";const Ne=ae({...Ge({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),$=le()({name:"VRadio",props:Ne(),setup(s,p){let{slots:d}=p;return te(()=>e(re,L(s,{class:["v-radio",s.class],style:s.style,type:"radio"}),d)),{}}});const Oe=ae({height:{type:[Number,String],default:"auto"},...me(),...ve(Te(),["multiple"]),trueIcon:{type:K,default:"$radioOn"},falseIcon:{type:K,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),ee=le()({name:"VRadioGroup",inheritAttrs:!1,props:Oe(),emits:{"update:modelValue":s=>!0},setup(s,p){let{attrs:d,slots:c}=p;const g=pe(),m=oe(()=>s.id||`radio-group-${g}`),V=be(s,"modelValue");return te(()=>{const[I,A]=fe(d),_=E.filterProps(s),D=re.filterProps(s),C=c.label?c.label({label:s.label,props:{for:m.value}}):s.label;return e(E,L({class:["v-radio-group",s.class],style:s.style},I,_,{modelValue:V.value,"onUpdate:modelValue":b=>V.value=b,id:m.value}),{...c,default:b=>{let{id:P,messagesId:R,isDisabled:k,isReadonly:v}=b;return e(ge,null,[C&&e(Ve,{id:P.value},{default:()=>[C]}),e(Me,L(D,{id:P.value,"aria-describedby":R.value,defaultsTarget:"VRadio",trueIcon:s.trueIcon,falseIcon:s.falseIcon,type:s.type,disabled:k.value,readonly:v.value,"aria-labelledby":C?P.value:void 0,multiple:!1},A,{modelValue:V.value,"onUpdate:modelValue":y=>V.value=y}),c)])}})}),{}}}),Le={style:{height:"100%"},class:"bg-back"},qe=se("h1",{class:"text-center mt-5 text-sixth"},"會員管理",-1),Ke=se("br",null,null,-1),oa={__name:"MembersView",setup(s){const{apiAuth:p}=he(),d=ke(),c=i(!1),g=i(!1),m=i(""),V=o=>{o?(m.value=o._id,R.value.value=o.account,k.value.value=o.role,v.value.value=o.blacklist,y.value.value=o.blacklistReason):m.value="",c.value=!0},I=()=>{c.value=!1,P()},A=o=>{m.value=o._id,R.value.value=o.account,g.value=!0},_=()=>{g.value=!1},D=_e({account:Q().required("缺少使用者帳號").typeError("信箱格式錯誤"),role:Se().required("缺少使用者角色"),blacklist:we().required("缺少使用者黑名單"),blacklistReason:Q().test("blacklistReason","異常原因必填",o=>v.value.value!=="false")}),{handleSubmit:C,isSubmitting:b,resetForm:P}=Be({validationSchema:D,initialValues:{account:"",role:0,blacklist:!1,blacklistReason:""}}),R=U("account"),k=U("role"),v=U("blacklist"),y=U("blacklistReason"),ne=async()=>{var o,l;try{await p.delete("/users/"+m.value),d({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),_(),h()}catch(a){console.log(a);const r=((l=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";d({text:r,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}},ue=C(async o=>{var l,a;try{const r=new FormData;for(const u in o)r.append(u,o[u]);await p.patch("/users/"+m.value,r),d({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),I(),M()}catch(r){console.log(r);const u=((a=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";d({text:u,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),F=i(10),S=i([{key:"createdAt",order:"desc"}]),w=i(1),G=i([]),ie=[{title:"帳號",align:"center",sortable:!0,key:"account"},{title:"管理員",align:"center",sortable:!0,key:"role"},{title:"狀態",align:"center",sortable:!0,key:"blacklist"},{title:"異常原因",align:"center",sortable:!0,key:"blacklistReason"},{title:"編輯",align:"center",sortable:!1,key:"edit"},{title:"刪除",align:"center",sortable:!1,key:"remove"}],T=i(!0),q=i(0),B=i(""),h=async()=>{var o,l,a,r;T.value=!0;try{const{data:u}=await p.get("/users/all",{params:{page:w.value,itemsPerPage:F.value,sortBy:((o=S.value[0])==null?void 0:o.key)||"createdAt",sortOrder:((l=S.value[0])==null?void 0:l.order)==="asc"?1:-1,search:B.value}});G.value.splice(0,G.value.length,...u.result.data),q.value=u.result.total}catch(u){console.log(u);const ce=((r=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:r.message)||"發生錯誤123，請稍後再試";d({text:ce,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}T.value=!1};h();const M=()=>{w.value=1,h()},de=oe(()=>!v.value.value);return(o,l)=>(N(),ye("div",Le,[e(Ue,null,{default:t(()=>[e($e,null,{default:t(()=>[e(Y,{cols:"12"},{default:t(()=>[qe]),_:1}),e(Y,{cols:"12"},{default:t(()=>[e(Ae,{"items-per-page":F.value,"onUpdate:itemsPerPage":[l[1]||(l[1]=a=>F.value=a),h],"sort-by":S.value,"onUpdate:sortBy":[l[2]||(l[2]=a=>S.value=a),h],page:w.value,"onUpdate:page":[l[3]||(l[3]=a=>w.value=a),h],items:G.value,headers:ie,loading:T.value,"items-length":q.value,search:B.value},{top:t(()=>[e(xe,{label:"搜尋","append-inner-icon":"mdi-magnify",modelValue:B.value,"onUpdate:modelValue":l[0]||(l[0]=a=>B.value=a),variant:"underlined","onClick:appendInner":M,onKeydown:Ce(M,["enter"])},null,8,["modelValue"])]),"item.role":t(({item:a})=>[a.role===1?(N(),j(O,{key:0,icon:"mdi-check",color:"sixth"})):z("",!0)]),"item.blacklist":t(({item:a})=>[a.blacklist===!0?(N(),j(O,{key:0,icon:"mdi-account-alert-outline",color:"seventh"})):z("",!0)]),"item.edit":t(({item:a})=>[e(x,{icon:"mdi-pencil",variant:"text",color:"sixth",onClick:r=>V(a)},null,8,["onClick"])]),"item.remove":t(({item:a})=>[e(x,{icon:"mdi-delete",variant:"text",color:"seventh",onClick:r=>A(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),e(Z,{modelValue:g.value,"onUpdate:modelValue":l[4]||(l[4]=a=>g.value=a),width:"300px"},{default:t(()=>[e(H,{rounded:"xl"},{default:t(()=>[e(O,{icon:"mdi-alert-circle",color:"seventh",size:"50",class:"ma-auto mt-5"}),e(J,null,{default:t(()=>[f("確定要刪除「"+Pe(n(R).value.value)+"」嗎？ ",1),Ke,f(" 此動作無法復原！")]),_:1}),e(W,null,{default:t(()=>[e(X),e(x,{color:"sixth",rounded:"",onClick:_},{default:t(()=>[f("取消")]),_:1}),e(x,{color:"seventh",rounded:"",onClick:ne},{default:t(()=>[f("確認刪除")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Z,{modelValue:c.value,"onUpdate:modelValue":l[8]||(l[8]=a=>c.value=a),persistent:"",width:"500px"},{default:t(()=>[e(Fe,{disabled:n(b),onSubmit:Re(n(ue),["prevent"])},{default:t(()=>[e(H,{rounded:"xl"},{default:t(()=>[e(Ie,{class:"text-center mt-3 pb-0"},{default:t(()=>[f("編輯使用者權限")]),_:1}),e(J,null,{default:t(()=>[e(ee,{modelValue:n(k).value.value,"onUpdate:modelValue":l[5]||(l[5]=a=>n(k).value.value=a),"error-messages":n(k).errorMessage.value,inline:""},{default:t(()=>[e($,{label:"一般會員",value:0}),e($,{label:"管理員",value:1})]),_:1},8,["modelValue","error-messages"]),e(ee,{modelValue:n(v).value.value,"onUpdate:modelValue":l[6]||(l[6]=a=>n(v).value.value=a),"error-messages":n(v).errorMessage.value,inline:""},{default:t(()=>[e($,{label:"正常",value:!1}),e($,{label:"異常",value:!0})]),_:1},8,["modelValue","error-messages"]),e(De,{label:"異常原因",variant:"outlined",density:"compact",class:"py-3",disabled:de.value,modelValue:n(y).value.value,"onUpdate:modelValue":l[7]||(l[7]=a=>n(y).value.value=a),"error-messages":n(y).errorMessage.value},null,8,["disabled","modelValue","error-messages"])]),_:1}),e(W,null,{default:t(()=>[e(X),e(x,{color:"sixth",rounded:"",disabled:n(b),onClick:I},{default:t(()=>[f("取消")]),_:1},8,["disabled"]),e(x,{color:"seventh",rounded:"",type:"submit",loading:n(b)},{default:t(()=>[f("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]))}};export{oa as default};
