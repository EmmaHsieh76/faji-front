import{p as ue,b8 as ie,aB as de,g as ce,u as me,b9 as ve,ba as pe,c as ge,f as fe,bb as be,bc as Z,h as a,i as G,T as Ve,r as n,X as Q,Y as ye,Z as ke,a0 as t,aY as W,a2 as xe,ab as he,V as g,a5 as f,ai as K,ak as Y,am as H,bd as Ce,a7 as oe,af as we,J as _e,a_ as ee,a6 as ae,a4 as r,al as Pe,aj as Be,a8 as Ae}from"./index-a29313c6.js";import{c as Ue,a as J,d as Fe,e as Se}from"./index.esm-639fe0e0.js";import{u as Me,a as _}from"./vee-validate.esm-ceffb0cf.js";import{V as Re}from"./VContainer-58affe69.js";import{V as le,a as D}from"./VRow-93998bfe.js";import{V as De}from"./VDivider-dd4f98b1.js";import{V as Ie,a as $e}from"./VTextarea-ef985505.js";import{V as Te}from"./VForm-3aee0f42.js";import{m as qe,c as te,b as je}from"./VDataTable-f4eac3f1.js";import"./VTable-9d54142c.js";import"./VList-63a8d6e1.js";import"./ssrBoot-8408990c.js";import"./VChip-8c3f6ccc.js";import"./VSlideGroup-f7352364.js";const ze=ue({...ie(),...de(qe(),["inline"])},"VCheckbox"),Le=ce()({name:"VCheckbox",inheritAttrs:!1,props:ze(),emits:{"update:modelValue":d=>!0,"update:focused":d=>!0},setup(d,b){let{attrs:m,slots:w}=b;const c=me(d,"modelValue"),{isFocused:i,focus:V,blur:P}=ve(d),B=pe(),I=ge(()=>d.id||`checkbox-${B}`);return fe(()=>{const[A,U]=be(m),$=Z.filterProps(d),T=te.filterProps(d);return a(Z,G({class:["v-checkbox",d.class]},A,$,{modelValue:c.value,"onUpdate:modelValue":v=>c.value=v,id:I.value,focused:i.value,style:d.style}),{...w,default:v=>{let{id:q,messagesId:y,isDisabled:k,isReadonly:x}=v;return a(te,G(T,{id:q.value,"aria-describedby":y.value,disabled:k.value,readonly:x.value},U,{modelValue:c.value,"onUpdate:modelValue":h=>c.value=h,onFocus:V,onBlur:P}),w)}})}),{}}});const Ne=oe("h1",{class:"text-center mt-5 text-sixth"},"商品管理",-1),Ee={class:"d-flex justify-center my-3"},oa={__name:"ProductsView",setup(d){const{apiAuth:b}=he(),m=Ve(),w=n(null),c=n(!1),i=n(""),V=n(!1),P=o=>{o?(i.value=o._id,y.value.value=o.name,k.value.value=o.price,x.value.value=o.description,h.value.value=o.category,F.value.value=o.sell):i.value="",c.value=!0},B=()=>{c.value=!1,q(),w.value.deleteFileRecord()},I=o=>{i.value=o._id,V.value=!0},A=()=>{V.value=!1},U=["人氣商品","期間限定","經典口味","新品上市"],$=Ue({name:J().required("缺少商品名稱"),price:Fe().typeError("商品價格必須是數字").required("缺少商品價格").min(0,"價格不可小於 0"),description:J().required("缺少商品說明"),category:J().required("缺少商品分類").test("isCategory","商品分類錯誤",o=>U.includes(o)),sell:Se()}),{handleSubmit:T,isSubmitting:v,resetForm:q}=Me({validationSchema:$,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),y=_("name"),k=_("price"),x=_("description"),h=_("category"),F=_("sell"),p=n([]),O=n([]),se=T(async o=>{var l,u;if(!(p.value>0&&p.value[0].error)&&!(i.value===""&&p.value.length===0))try{const s=new FormData;for(const e in o)s.append(e,o[e]);if(p.value.length>0)for(const e of p.value)s.append("images",e.file);i.value===""?await b.post("/products",s):await b.patch("/products/"+i.value,s),m({text:i.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"forth",location:"bottom"}}),B(),N()}catch(s){console.error("發生錯誤:",s),s.response?console.error("錯誤回應資料:",s.response.data):s.request?console.error("請求未收到回應:",s.request):console.error("錯誤訊息:",s.message);const e=((u=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:u.message)||"發生錯誤，請稍後再試";m({text:e,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"seventh",location:"bottom"}})}}),re=async()=>{var o,l;try{await b.delete("/products/"+i.value),m({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"forth",location:"bottom"}}),A(),C()}catch(u){console.log(u);const s=((l=(o=u==null?void 0:u.response)==null?void 0:o.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";m({text:s,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"seventh",location:"bottom"}})}},j=n(10),S=n([{key:"createdAt",order:"desc"}]),M=n(1),z=n([]),ne=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"},{title:"刪除",align:"center",sortable:!1,key:"remove"}],L=n(!0),X=n(0),R=n(""),C=async()=>{var o,l,u,s;L.value=!0;try{const{data:e}=await b.get("/products/all",{params:{page:M.value,itemsPerPage:j.value,sortBy:((o=S.value[0])==null?void 0:o.key)||"createdAt",sortOrder:((l=S.value[0])==null?void 0:l.order)==="asc"?1:-1,search:R.value}});z.value.splice(0,z.value.length,...e.result.data),X.value=e.result.total}catch(e){console.log("前端product/getAll錯誤",e),console.log("前端product/getAll錯誤",e.message);const E=((s=(u=e==null?void 0:e.response)==null?void 0:u.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";m({text:E,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"seventh",location:"bottom"}})}L.value=!1};C();const N=()=>{M.value=1,C()};return(o,l)=>{const u=Q("RouterLink"),s=Q("VueFileAgent");return ye(),ke(xe,null,[a(Re,null,{default:t(()=>[a(le,null,{default:t(()=>[a(D,{cols:"12"},{default:t(()=>[Ne,a(De)]),_:1}),a(D,{cols:"12"},{default:t(()=>[a(Ie,{"items-per-page":j.value,"onUpdate:itemsPerPage":[l[2]||(l[2]=e=>j.value=e),C],"sort-by":S.value,"onUpdate:sortBy":[l[3]||(l[3]=e=>S.value=e),C],page:M.value,"onUpdate:page":[l[4]||(l[4]=e=>M.value=e),C],items:z.value,headers:ne,loading:L.value,"items-length":X.value,search:R.value,hover:""},{top:t(()=>[a(le,{class:"mb-1"},{default:t(()=>[a(D,{cols:"8",class:"d-flex justify-start align-center"},{default:t(()=>[a(g,{color:"sixth",variant:"outlined",onClick:l[0]||(l[0]=e=>P()),size:"x-large"},{default:t(()=>[f("新增商品 ")]),_:1})]),_:1}),a(D,{cols:"4"},{default:t(()=>[a(K,{color:"grey-lighten-6","max-width":"40vw"},{default:t(()=>[a(Y,null,{default:t(()=>[a(H,{label:"搜尋商品",clearable:"",density:"compact",variant:"outlined","hide-details":"",color:"blue-darken-4","append-inner-icon":"mdi-magnify",modelValue:R.value,"onUpdate:modelValue":l[1]||(l[1]=e=>R.value=e),"onClick:append":N,onKeydown:Ce(N,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),"item.image":t(({item:e})=>[oe("div",Ee,[a(u,{to:"/products/"+e._id,style:{width:"100px",height:"100px"}},{default:t(()=>[a(we,{src:e.images[0],height:"100",width:"100",cover:"",rounded:"lg"},null,8,["src"])]),_:2},1032,["to"])])]),"item.sell":t(({item:e})=>[a(_e,{color:"sixth",icon:e.sell?"mdi-check":"mdi-minus",size:"large"},null,8,["icon"])]),"item.edit":t(({item:e})=>[a(g,{icon:"mdi-pencil",variant:"text",size:"large",color:"sixth",onClick:E=>P(e)},null,8,["onClick"])]),"item.remove":t(({item:e})=>[a(g,{icon:"mdi-delete",variant:"text",color:"seventh",onClick:E=>I(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),a(W,{modelValue:V.value,"onUpdate:modelValue":l[5]||(l[5]=e=>V.value=e),width:"300px"},{default:t(()=>[a(K,{rounded:"xl"},{default:t(()=>[a(Y,null,{default:t(()=>[f("確認要刪除此項商品嗎?")]),_:1}),a(ee,null,{default:t(()=>[a(ae),a(g,{color:"seventh",rounded:"",onClick:A},{default:t(()=>[f("取消")]),_:1}),a(g,{color:"sixth",rounded:"",onClick:re},{default:t(()=>[f("確定刪除")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(W,{modelValue:c.value,"onUpdate:modelValue":l[13]||(l[13]=e=>c.value=e),persistent:"",width:"500px"},{default:t(()=>[a(Te,{disabled:r(v),onSubmit:Pe(r(se),["prevent"])},{default:t(()=>[a(K,null,{default:t(()=>[a(Be,null,{default:t(()=>[f(Ae(i.value===""?"新增商品":"編輯商品"),1)]),_:1}),a(Y,null,{default:t(()=>[a(H,{label:"名稱",modelValue:r(y).value.value,"onUpdate:modelValue":l[6]||(l[6]=e=>r(y).value.value=e),variant:"outlined","error-messages":r(y).errorMessage.value},null,8,["modelValue","error-messages"]),a(H,{label:"價格",type:"number",min:"0",modelValue:r(k).value.value,"onUpdate:modelValue":l[7]||(l[7]=e=>r(k).value.value=e),variant:"outlined","error-messages":r(k).errorMessage.value},null,8,["modelValue","error-messages"]),a(je,{label:"分類",items:U,modelValue:r(h).value.value,"onUpdate:modelValue":l[8]||(l[8]=e=>r(h).value.value=e),variant:"outlined","error-messages":r(h).errorMessage.value},null,8,["modelValue","error-messages"]),a(Le,{label:"上架",modelValue:r(F).value.value,"onUpdate:modelValue":l[9]||(l[9]=e=>r(F).value.value=e),variant:"outlined","error-messages":r(F).errorMessage.value},null,8,["modelValue","error-messages"]),a($e,{label:"商品說明",placeholder:"商品說明",variant:"outlined",modelValue:r(x).value.value,"onUpdate:modelValue":l[10]||(l[10]=e=>r(x).value.value=e),class:"py-10","error-messages":r(x).errorMessage.value},null,8,["modelValue","error-messages"]),a(s,{modelValue:p.value,"onUpdate:modelValue":l[11]||(l[11]=e=>p.value=e),rawModelValue:O.value,"onUpdate:rawModelValue":l[12]||(l[12]=e=>O.value=e),multiple:!0,accept:"image/png, image/jpeg, image/jpg",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 限制"},"help-text":"點擊檔案或拖曳檔案至此","max-files":3,"max-size":"1MB",ref_key:"fileAgent",ref:w},null,8,["modelValue","rawModelValue"])]),_:1}),a(ee,null,{default:t(()=>[a(ae),a(g,{color:"red",variant:"tonal",disabled:r(v),onClick:B},{default:t(()=>[f("取消")]),_:1},8,["disabled"]),a(g,{color:"blue-darken-4",variant:"tonal",type:"submit",loading:r(v)},{default:t(()=>[f("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};export{oa as default};
