import{p as ae,g as le,f as te,h as e,i as L,b6 as me,az as ve,I as z,b8 as pe,c as oe,u as be,b9 as fe,ba as E,a2 as ge,bc as Ve,T as ke,r as i,Y as N,Z as ye,a0 as l,aW as K,ab as he,ak as xe,bb as Ce,aX as Pe,af as Re,$ as Y,a1 as j,V as x,a5 as p,ag as H,J as O,ai as J,a8 as Ie,a4 as n,aY as W,a6 as X,aj as _e,ah as Se,a7 as se}from"./index-88875773.js";import{c as we,a as Z,d as Be,e as Ue}from"./index.esm-639fe0e0.js";import{u as $e,a as U}from"./vee-validate.esm-6dd9e694.js";import{V as Ae}from"./VContainer-48761505.js";import{V as De,a as Q}from"./VRow-8ea6bdb8.js";import{V as Fe,a as Te}from"./VTextarea-f1b7a853.js";import{V as Ge}from"./VForm-abf64a2f.js";import{d as Me,e as re,f as Ne,g as Oe}from"./VDataTable-bb925534.js";import"./VTable-35ccac33.js";import"./VList-0da2df0b.js";import"./ssrBoot-8a9bbc11.js";import"./VDivider-0346f9c1.js";import"./VChip-aba85bc6.js";import"./VSlideGroup-0eedd6a7.js";const Le=ae({...Me({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),$=le()({name:"VRadio",props:Le(),setup(s,b){let{slots:d}=b;return te(()=>e(re,L(s,{class:["v-radio",s.class],style:s.style,type:"radio"}),d)),{}}});const qe=ae({height:{type:[Number,String],default:"auto"},...me(),...ve(Ne(),["multiple"]),trueIcon:{type:z,default:"$radioOn"},falseIcon:{type:z,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),ee=le()({name:"VRadioGroup",inheritAttrs:!1,props:qe(),emits:{"update:modelValue":s=>!0},setup(s,b){let{attrs:d,slots:c}=b;const g=pe(),m=oe(()=>s.id||`radio-group-${g}`),V=be(s,"modelValue");return te(()=>{const[I,A]=fe(d),_=E.filterProps(s),D=re.filterProps(s),C=c.label?c.label({label:s.label,props:{for:m.value}}):s.label;return e(E,L({class:["v-radio-group",s.class],style:s.style},I,_,{modelValue:V.value,"onUpdate:modelValue":f=>V.value=f,id:m.value}),{...c,default:f=>{let{id:P,messagesId:R,isDisabled:k,isReadonly:v}=f;return e(ge,null,[C&&e(Ve,{id:P.value},{default:()=>[C]}),e(Oe,L(D,{id:P.value,"aria-describedby":R.value,defaultsTarget:"VRadio",trueIcon:s.trueIcon,falseIcon:s.falseIcon,type:s.type,disabled:k.value,readonly:v.value,"aria-labelledby":C?P.value:void 0,multiple:!1},A,{modelValue:V.value,"onUpdate:modelValue":y=>V.value=y}),c)])}})}),{}}}),ze={style:{height:"100%"},class:"bg-back"},Ee=se("h1",{class:"text-center mt-5 text-sixth"},"會員管理",-1),Ke=se("br",null,null,-1),ra={__name:"MembersView",setup(s){const{apiAuth:b}=he(),d=ke(),c=i(!1),g=i(!1),m=i(""),V=o=>{o?(m.value=o._id,R.value.value=o.account,k.value.value=o.role,v.value.value=o.blacklist,y.value.value=o.blacklistReason):m.value="",c.value=!0},I=()=>{c.value=!1,P()},A=o=>{m.value=o._id,R.value.value=o.account,g.value=!0},_=()=>{g.value=!1},D=we({account:Z().required("缺少使用者帳號").typeError("信箱格式錯誤"),role:Be().required("缺少使用者角色"),blacklist:Ue().required("缺少使用者黑名單"),blacklistReason:Z().test("blacklistReason","異常原因必填",o=>v.value.value!=="false")}),{handleSubmit:C,isSubmitting:f,resetForm:P}=$e({validationSchema:D,initialValues:{account:"",role:0,blacklist:!1,blacklistReason:""}}),R=U("account"),k=U("role"),v=U("blacklist"),y=U("blacklistReason"),ne=async()=>{var o,t;try{await b.delete("/users/"+m.value),d({text:"刪除成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),_(),h()}catch(a){console.log(a);const r=((t=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";d({text:r,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}},ue=C(async o=>{var t,a;try{const r=new FormData;for(const u in o)r.append(u,o[u]);await b.patch("/users/"+m.value,r),d({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),I(),M()}catch(r){console.log(r);const u=((a=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";d({text:u,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),F=i(10),S=i([{key:"createdAt",order:"desc"}]),w=i(1),T=i([]),ie=[{title:"大頭貼",align:"center",sortable:!1,key:"avatar"},{title:"帳號",align:"center",sortable:!0,key:"account"},{title:"管理員",align:"center",sortable:!0,key:"role"},{title:"狀態",align:"center",sortable:!0,key:"blacklist"},{title:"異常原因",align:"center",sortable:!0,key:"blacklistReason"},{title:"編輯",align:"center",sortable:!1,key:"edit"},{title:"刪除",align:"center",sortable:!1,key:"remove"}],G=i(!0),q=i(0),B=i(""),h=async()=>{var o,t,a,r;G.value=!0;try{const{data:u}=await b.get("/users/all",{params:{page:w.value,itemsPerPage:F.value,sortBy:((o=S.value[0])==null?void 0:o.key)||"createdAt",sortOrder:((t=S.value[0])==null?void 0:t.order)==="asc"?1:-1,search:B.value}});T.value.splice(0,T.value.length,...u.result.data),q.value=u.result.total}catch(u){console.log(u);const ce=((r=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:r.message)||"發生錯誤123，請稍後再試";d({text:ce,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}G.value=!1};h();const M=()=>{w.value=1,h()},de=oe(()=>!v.value.value);return(o,t)=>(N(),ye("div",ze,[e(Ae,null,{default:l(()=>[e(De,null,{default:l(()=>[e(Q,{cols:"12"},{default:l(()=>[Ee]),_:1}),e(Q,{cols:"12"},{default:l(()=>[e(Fe,{"items-per-page":F.value,"onUpdate:itemsPerPage":[t[1]||(t[1]=a=>F.value=a),h],"sort-by":S.value,"onUpdate:sortBy":[t[2]||(t[2]=a=>S.value=a),h],page:w.value,"onUpdate:page":[t[3]||(t[3]=a=>w.value=a),h],items:T.value,headers:ie,loading:G.value,"items-length":q.value,search:B.value},{top:l(()=>[e(xe,{label:"搜尋","append-inner-icon":"mdi-magnify",modelValue:B.value,"onUpdate:modelValue":t[0]||(t[0]=a=>B.value=a),variant:"underlined","onClick:appendInner":M,onKeydown:Ce(M,["enter"])},null,8,["modelValue"])]),"item.avatar":l(({item:a})=>[e(Pe,{size:"30"},{default:l(()=>[e(Re,{src:a.avatar,contain:""},null,8,["src"])]),_:2},1024)]),"item.role":l(({item:a})=>[a.role===1?(N(),Y(O,{key:0,icon:"mdi-check",color:"sixth"})):j("",!0)]),"item.blacklist":l(({item:a})=>[a.blacklist===!0?(N(),Y(O,{key:0,icon:"mdi-account-alert-outline",color:"seventh"})):j("",!0)]),"item.edit":l(({item:a})=>[e(x,{icon:"mdi-pencil",variant:"text",color:"sixth",onClick:r=>V(a)},null,8,["onClick"])]),"item.remove":l(({item:a})=>[e(x,{icon:"mdi-delete",variant:"text",color:"seventh",onClick:r=>A(a)},null,8,["onClick"])]),default:l(()=>[p("` ")]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),e(K,{modelValue:g.value,"onUpdate:modelValue":t[4]||(t[4]=a=>g.value=a),width:"300px"},{default:l(()=>[e(H,{rounded:"xl"},{default:l(()=>[e(O,{icon:"mdi-alert-circle",color:"seventh",size:"50",class:"ma-auto mt-5"}),e(J,null,{default:l(()=>[p("確定要刪除「"+Ie(n(R).value.value)+"」嗎？ ",1),Ke,p(" 此動作無法復原！")]),_:1}),e(W,null,{default:l(()=>[e(X),e(x,{color:"sixth",rounded:"",onClick:_},{default:l(()=>[p("取消")]),_:1}),e(x,{color:"seventh",rounded:"",onClick:ne},{default:l(()=>[p("確認刪除")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(K,{modelValue:c.value,"onUpdate:modelValue":t[8]||(t[8]=a=>c.value=a),persistent:"",width:"500px"},{default:l(()=>[e(Ge,{disabled:n(f),onSubmit:_e(n(ue),["prevent"])},{default:l(()=>[e(H,{rounded:"xl"},{default:l(()=>[e(Se,{class:"text-center mt-3 pb-0"},{default:l(()=>[p("編輯使用者權限")]),_:1}),e(J,null,{default:l(()=>[e(ee,{modelValue:n(k).value.value,"onUpdate:modelValue":t[5]||(t[5]=a=>n(k).value.value=a),"error-messages":n(k).errorMessage.value,inline:""},{default:l(()=>[e($,{label:"一般會員",value:0}),e($,{label:"管理員",value:1})]),_:1},8,["modelValue","error-messages"]),e(ee,{modelValue:n(v).value.value,"onUpdate:modelValue":t[6]||(t[6]=a=>n(v).value.value=a),"error-messages":n(v).errorMessage.value,inline:""},{default:l(()=>[e($,{label:"正常",value:!1}),e($,{label:"異常",value:!0})]),_:1},8,["modelValue","error-messages"]),e(Te,{label:"異常原因",variant:"outlined",density:"compact",class:"py-3",disabled:de.value,modelValue:n(y).value.value,"onUpdate:modelValue":t[7]||(t[7]=a=>n(y).value.value=a),"error-messages":n(y).errorMessage.value},null,8,["disabled","modelValue","error-messages"])]),_:1}),e(W,null,{default:l(()=>[e(X),e(x,{color:"sixth",rounded:"",disabled:n(f),onClick:I},{default:l(()=>[p("取消")]),_:1},8,["disabled"]),e(x,{color:"seventh",rounded:"",type:"submit",loading:n(f)},{default:l(()=>[p("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]))}};export{ra as default};
