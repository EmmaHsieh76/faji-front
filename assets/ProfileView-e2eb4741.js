import{_ as I,$ as Z,Z as J,x as i,a1 as W,a2 as w,a3 as X,c as e,a5 as l,aX as Y,a7 as G,ag as H,aY as K,a9 as t,J as p,ac as L,ad as O,aj as P,ak as Q,W as h,aa as b,ab as U,a4 as z,am as ee,al as ae,an as k,aZ as D}from"./index-74e5a170.js";import{u as le,a as C}from"./vee-validate.esm-c8c5999e.js";import{v as oe}from"./index-ee6bba0e.js";import{c as te,a as y}from"./index.esm-639fe0e0.js";import{V as se}from"./VContainer-986baf93.js";import{V as E,a as f}from"./VRow-98fb790a.js";import{V as ne}from"./VForm-0d117d68.js";const ue={class:"text-primary"},re={__name:"ProfileView",setup(ie){const{apiAuth:B}=H(),s=Z(),g=J(),r=i(!1),A=i(null),V=i(!1),R=n=>{V.value=!0},F=()=>{V.value=!1,A.value.deleteFileRecord()},_=i(!1),T=te({account:y().required("缺少使用者帳號").test("isEmail","信箱格式錯誤",n=>oe.isEmail(n)),name:y().required("缺少使用者名稱"),phone:y()}),{handleSubmit:j,isSubmitting:S}=le({validationSchema:T,initialValues:{account:"",name:"",phone:""}}),c=C("account"),d=C("name"),m=C("phone");c.value.value=s.account,d.value.value=s.name,m.value.value=s.phone;const N=()=>{c.value.value=s.account,d.value.value=s.name,m.value.value=s.phone,r.value=!1},$=j(async n=>{var o,u;try{await B.patch("/users/self",n),console.log(n),s.getProfile(),g({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"center"}}),r.value=!1}catch(a){console.log(a);const x=((u=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:u.message)||"發生錯誤，請稍後再試";g({text:x,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"center"}})}}),v=i([]),M=i([]),q=async()=>{var n,o,u;if(_.value=!0,!((n=v.value[0])!=null&&n.error)){try{const a=new FormData;v.value.length>0&&a.append("image",v.value[0].file),await B.patch("/users/avatar",a),s.getProfile(),g({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"back",location:"bottom"}}),F()}catch(a){console.log(a);const x=((u=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:u.message)||"發生錯誤，請稍後再試";g({text:x,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"secondary",location:"bottom"}})}_.value=!1}};return(n,o)=>{const u=W("VueFileAgent");return w(),X(G,null,[e(se,null,{default:l(()=>[e(E,null,{default:l(()=>[e(f,{cols:"6"},{default:l(()=>[e(K,{image:t(s).avatar,size:"260"},null,8,["image"]),e(p,{icon:"mdi-pencil",size:"x-small",color:"primary",style:{"vertical-align":"bottom"},onClick:R}),L("h2",ue,O(t(s).account),1)]),_:1}),e(f,{cols:"6"},{default:l(()=>[e(P,{class:"mx-auto","max-width":"344"},{default:l(()=>[e(Q,{class:"third font-weight-bold text-center"},{default:l(()=>[e(h,{class:"ps-8",icon:"mdi-account"}),b(" 個人資料 "),e(U),e(p,null,{default:l(()=>[r.value?(w(),z(h,{key:0,onClick:r.value,icon:"mdi-pencil"},null,8,["onClick"])):(w(),z(h,{key:1,icon:"mdi-close",onClick:N}))]),_:1})]),_:1}),e(ne,{onSubmit:ee(t($),["prevent"]),disable:t(S)||!r.value},{default:l(()=>[e(ae,{class:"pa-10"},{default:l(()=>[e(E,null,{default:l(()=>[e(f,{cols:"12",class:"pb-0"},{default:l(()=>[e(k,{lable:"帳號",variant:"outlined",modelValue:t(c).value.value,"onUpdate:modelValue":o[0]||(o[0]=a=>t(c).value.value=a),"error-messages":t(c).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(f,{cols:"12",class:"pb-0"},{default:l(()=>[e(k,{lable:"姓名",variant:"outlined",modelValue:t(d).value.value,"onUpdate:modelValue":o[1]||(o[1]=a=>t(d).value.value=a),"error-messages":t(d).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(f,{cols:"12",class:"pb-0"},{default:l(()=>[e(k,{lable:"電話",variant:"outlined",modelValue:t(m).value.value,"onUpdate:modelValue":o[2]||(o[2]=a=>t(m).value.value=a),"error-messages":t(m).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),e(D,null,{default:l(()=>[e(p,{color:"forth",size:"x-large",class:"font-weight-bold d-flex w-100",variant:"tonal",type:"submit",loading:t(S),disabled:!r.value},{default:l(()=>[b(" 確認修改個人資料 ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["onSubmit","disable"])]),_:1})]),_:1})]),_:1})]),_:1}),e(Y,{modelValue:V.value,"onUpdate:modelValue":o[5]||(o[5]=a=>V.value=a),width:"300px"},{default:l(()=>[e(P,{rounded:"xl",class:"px-5 pt-5"},{default:l(()=>[e(u,{modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=a=>v.value=a),rawModelValue:M.value,"onUpdate:rawModelValue":o[4]||(o[4]=a=>M.value=a),accept:"image/jpeg, image/png","max-size":"1MB","error-text":{type:"檔案格式不支援, 只接受 .jepg .png",size:"檔案大小超過 1MB"},deletable:"","help-text":"選擇大頭貼圖片或拖曳到這裡","max-files":1,ref_key:"fileAgent",ref:A},null,8,["modelValue","rawModelValue","error-text"]),e(D,null,{default:l(()=>[e(U),e(p,{color:"seventh",rounded:"",onClick:F,disabled:_.value},{default:l(()=>[b("取消")]),_:1},8,["disabled"]),e(p,{color:"forth",rounded:"",onClick:q,disabled:_.value},{default:l(()=>[b("送出")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},Ve=I(re,[["__scopeId","data-v-1440a259"]]);export{Ve as default};
